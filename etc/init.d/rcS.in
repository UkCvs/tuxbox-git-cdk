#!/bin/sh

PATH=/sbin:/bin

hostname -F /etc/hostname
mount -a
echo -n >/etc/network/ifstate
ifup -a

test -O /bin/tinylogin || chown root.root /bin/tinylogin

@TARGETRULESET_FLASH_TRUE@if test -d /share/tuxbox/image/var ; then
@TARGETRULESET_FLASH_TRUE@for i in `cd /share/tuxbox/image/var ; find . -type d` ; do test -d /var/$i || mkdir -p /var/$i ; done
@TARGETRULESET_FLASH_TRUE@for i in `cd /share/tuxbox/image/var ; find . -type f` ; do test -f /var/$i || cp -a /share/tuxbox/image/var/$i /var/$i ; done
@TARGETRULESET_FLASH_TRUE@fi
@TARGETRULESET_FLASH_TRUE@test -d /var/lib/modules/`uname -r` || mkdir -p /var/lib/modules/`uname -r`

test -x /sbin/inetd && inetd

if test -x /sbin/sshd ; then
	/etc/init.d/start_sshd &
fi

@TARGETRULESET_FLASH_TRUE@test -f /var/lib/modules/`uname -r`/modules.dep || \
depmod -ae

insmod i2c-8xx
insmod info

if [ -e /tmp/dbox.sh ]; then
        rm -f /tmp/dbox.sh
fi

. /etc/profile
echo "mID: $mID"
echo "feID: $feID"
echo "fpID: $fpID"
echo "enxID: $enxID"
echo "gtxID: $gtxID"
echo "hwREV: $hwREV"
echo "fpREV: $fpREV"
echo "DEMOD: $DEMOD"

test -x /bin/loadkeys && loadkeys /share/keymaps/i386/qwertz/de-latin1.kmap.gz

insmod event
insmod saa7126
insmod avs
insmod input
insmod keybdev
insmod mousedev
insmod joydev
insmod evdev
insmod dvb_frontend
insmod dvb_filter
insmod dmxdev
insmod dvb_demux
insmod fp


insmod avia_av firmware=/var/tuxbox/ucodes &
insmod dvbdev

insmod avia_gt ucode=/var/tuxbox/ucodes/ucode.bin hw_sections=1 
insmod avia_gt_oss
insmod avia_gt_dvr
insmod avia_gt_fb console_transparent=0 
insmod cam firmware=/var/tuxbox/ucodes/cam-alpha.bin 


insmod dvb

if [ $DEMOD = "AT76C651" ];then
	alias tuner='insmod at76c651'
elif [ $DEMOD = "TDA8044H" ] ;then
	alias tuner='insmod tda8044h'
elif [ $DEMOD = "VES1820" ] ;then
	alias tuner='insmod ves1820'
elif [ $DEMOD = "VES1893" ] ;then
	alias tuner='insmod ves1893'
elif [ $DEMOD = "VES1993" ] ;then
	alias tuner='insmod ves1993'
fi

tuner


insmod avia_gt_napi 
insmod dvb_net
insmod lcd

mkdir /dev/ost
for i in audio ca demux dvr frontend net sec video; do ln -sf ../dvb/card0/${i}0 /dev/ost/${i}; ln -sf ../dvb/card0/${i}0 /dev/ost/${i}0; done
for i in demux dvr; do ln -sf ${i}0 /dev/dvb/card0/${i}1; ln -sf ../dvb/card0/${i}1 /dev/ost/${i}1; done


